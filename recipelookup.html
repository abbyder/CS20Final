<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>Recipe Form</title>
</head>

<body>
	<form method='get' onsubmit="event.preventDefault()">
        <table>
            <tr>
              <td>Select Ingredients:</td>
              <td>
                <input type="checkbox" class="ingredient" value="chicken">
                <label for="ingredient1">Chicken</label><br>
                <input type="checkbox" class="ingredient" value="steak">
                <label for="ingredient2">Steak</label><br>

              </td>
            </tr>
            <tr>
                <td>Max Cooking time (minutes):</td>
                <td><input type='text' name='minutes'/></td>
            </tr>
            <tr>
                <td>Course Type:</td>
                <td>
                    <select name='mealtype' id='mealtype'>
                    <option>All</option>
                    <option>Breakfast</option>
                    <option>Lunch</option>
                    <option>Dinner</option>
                    <option>Dessert</option>
                    </select>
                </td>
            </tr>
            <tr>
                <td>Dietary Options:</td>
                <td>
                    <select name='diet' id='diet'>
                    <option>none</option>
                    <option>balanced</option>
                    <option>high-fiber</option>
                    <option>high-protein</option>
                    <option>low-carb</option>
                    <option>low-fat</option>
                    <option>low-sodium</option>
                    </select>
                </td>
            </tr>
        </table>
    <input type = 'submit'  value= 'Search' onclick="sendReq()"/>
	</form>
    <div id="recipes">

    </div>
<script>

function sendReq()
{
    //process additional search modifiers into strings and append request URL
    var additionalQueries = "";

    var mealtype = document.getElementById('mealtype').value;
    if(mealtype != 'All')
    {
        additionalQueries = additionalQueries + "&mealType=" + mealtype;
    }

	var diet = document.getElementById('diet').value;
    if(diet != 'none')
    {
        additionalQueries = additionalQueries + "&diet=" + diet;
    }

    //process ingredients into string
    var query = "";
    var atLeastOneSelected = false;

    var ingredients = document.querySelectorAll('.ingredient');

    for (var i = 0; i < ingredients.length; i++) 
    {
        if(ingredients[i].checked) 
        {
            atLeastOneSelected = true;
            query = query + " " + (ingredients[i].value);
        }
    }

    if(atLeastOneSelected === false)
    {
        alert("Please Select at Least 1 Ingredient!");
        return false;
    }
    else
    {
        var requestURL = `https://api.edamam.com/search?q=${query}&app_id=523efb53&app_key=a72279eac472b5a8e9a9ce6f904aaea4${additionalQueries}`;
        fetch(requestURL)
        .then(response => response.json())
        .then(data => 
        {
            //store entire response
            var jsonData = data;
            console.log(jsonData);

            //isolate recipes
            var hits = jsonData.hits;

            //get recipeSection as an object and clear it in case of a re-search
            var recipeSection = document.getElementById("recipes");
            recipeSection.textContent="";

            for (var i = 1; i < hits.length + 1; i++) 
            {
                //create recipe variable
                var currentRecipe = hits[i-1];

                //get recipe title string
                var recipeLabel = hits[i-1].recipe.label;

                //create header object for storing recipe name
                var recipeLabelObject = document.createElement('h1');
                recipeLabelObject.textContent = `Recipe ${i}: ${recipeLabel}`;

                //create div object for storing entire recipe and add header
                var recipeListItem = document.createElement('div');
                recipeListItem.appendChild(recipeLabelObject);

                //create list object for storing ingredients, then add to div
                var ingredientList = document.createElement('ul');
                var peep = currentRecipe.ingredients;
                console.log(peep.length);
                for (var j = 0; j < currentRecipe.ingredients.length; j++) 
                {
                    var ingredient = document.createElement('li');
                    ingredient.textContent = currentRecipe.ingredients[j].text;
                    ingredientsList.appendChild(ingredient);
                }
                recipeListItem.appendChild(ingredientList);

                //add entire recipe item to div
                recipeSection.appendChild(recipeListItem);
                console.log(`Recipe ${i}: ${recipeLabel}`);
            }
        })  
        .catch(error => console.error(error));
    }
}
</script>

</body>
</html>
