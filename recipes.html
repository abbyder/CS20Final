<html>
    <head>
        <title>Recipes | MyMeals</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel = "stylesheet" type = "text/css" href = "recipeheader.css">
        <style type="text/css">
            html, body {
            font-family: 'Lucida Sans', 'Lucida Sans Regular', 'Lucida Grande', 'Lucida Sans Unicode', Geneva, Verdana, sans-serif;
        }

        #color {
            color:#ffa4d0;
        }
            .form {
                background-color: coral;
                filter: drop-shadow(0 0 0.6rem #e7e7e7);
                border-radius: 20px;
                padding-top: 20px;
                width: 1136px;
                display: block;
                margin: 0 auto;
                margin-top: 20px;
                padding-bottom: 20px;
            }
            .collapse {
                background-color: coral;
                padding-top: 20px;
                width: 1136px;
                display: block;
                margin: 0 auto;
                margin-top: 50px;
                padding-bottom: 20px;
                display: none;
                border-radius: 12px
            }
            .num {
                display: inline-block;
                background-color: #fff;
                border-radius: 50%;
                margin-right: 20px;
                font-size: 30px;
                width: 60px;
                height: 60px;
                line-height: 60px;
                text-align: center;
            }
            h2 {
                color: black;
                font-size: 30px
            }
            .title {
                height: 60px;
                line-height: 60px;
                font-size: 20px;
                margin-right: 50px;
                color:rgb(0, 0, 0);
            }
            #submit {
                border-radius: 8px;
                background-color:#fff;
                color:rgb(0, 0, 0);
                border: none;
                width: 250px;
                height: 40px;
                font-size: 20px;
                margin: 0 auto;

            }
            #submit:hover {
                background-color:#e3e3e3
            }
            #edit {
                border-radius: 8px;
                background-color:#fff;
                color:rgb(0, 0, 0);
                border: none;
                width: 250px;
                height: 40px;
                font-size: 20px;
            }
            #edit:hover {
                background-color:#e3e3e3
            }
            .editbtn {
                width: 250px;
                margin: 0 auto
            }
            .submitbtn {
                width: 250px;
                margin: 0 auto
            }
            td {
                padding-top: 30px;
            }
            .ingredients {
                font-size: 20px;
            }
            h1 {
                text-align: center;
                font-size: 35px;
                margin-top: 50px
            }
            #mealtype {
                color:rgb(0, 0, 0);
                height: 30px;
                width: 100px;
                font-size: 15px;
                text-align: center
            }
            #nutrition {
                color:rgb(0, 0, 0);
                height: 30px;
                width: 100px;
                font-size: 15px;
                text-align: center
            }
            input[type="number"] {
                color:black;
                height: 30px;
                width: 100px;
                font-size: 15px;
                text-align: center;
                font-family: 'Lucida Sans', 'Lucida Sans Regular', 'Lucida Grande', 'Lucida Sans Unicode', Geneva, Verdana, sans-serif;
            }
            table {
                margin: 0 auto
            }

            input[type="button"] {
                font-family: 'Lucida Sans', 'Lucida Sans Regular', 'Lucida Grande', 'Lucida Sans Unicode', Geneva, Verdana, sans-serif;
            }

            select {
                font-family: 'Lucida Sans', 'Lucida Sans Regular', 'Lucida Grande', 'Lucida Sans Unicode', Geneva, Verdana, sans-serif;
            }
            

            #listofingred, #allergies, #diet {
                color: rgb(0, 0, 0);
                font-size: 18px;
                line-height: 27px
            }
            #recipeTitle {
                text-align: center;
                font-size: 27px;
                color:black;
            }
            #recipes {
                display: block;
                width: 1136px;
                margin: 0 auto;
                text-align: center;
                font-size: 18px;
                margin-top: 30px;
                color: black;
            }
            #recipeList {
                text-align:left;
                width: 548px;
                padding-right: 20px;
                float: right;
                list-style-type:circle;
                line-height: 27px;
                margin-top: 0px;
                padding-top: 0px;
            }
            #recipeImage {
                text-align: right;
                width: 548px;
                padding-bottom: 20px;
            }
            #recipeListItem {
                display: inline-block;
                width: 1136px;
                background-color:#fff;
                filter: drop-shadow(0 0 0.6rem #e7e7e7);
                border-radius: 20px;
                margin-bottom: 30px;
                padding-bottom: 30px;
            }

            .tdTitle {
                vertical-align: top;
            }

            #recipeLink {
                color:black;
                text-decoration: none;
            }





            /* header */
        .prof-header {
            width: 630px;
            height: 300px;
            background-color: white;
            align-items: center;    
            z-index: 2;
            filter: drop-shadow(0 0 0.6rem #e7e7e7);
            position: relative;
            top: 100px;
            border-radius: 20px;
        }

        #prof-header-bg {
            background-color: #f9d149;
            height: 300px;
            display: flex;
            justify-content: center;
            position: relative;
            margin-bottom: 175px
        }

        #prof-header-text-box {
            display: flex;
            justify-content: center;
            margin-top: 50px;
            text-align: center
        }

        p {
            padding-left: 20px;
            padding-right: 20px;
            font-size: 18px
        }

        #linkDiv {
            background-color: coral;
            width: 175px;
            height: 35px;
            border-radius: 8px;
            display: block;
            margin: 0 auto;
            line-height: 35px
        }

        #linkDiv:hover{
            background-color:#f9d149;
        }




            @media (max-width: 1380px) { .form {width: 1180px} .collapse {width: 1180px} }
            @media (max-width: 1380px) { #recipes {width: 1180px} #recipeListItem {width: 1180px} }
            @media (max-width: 1380px) { #recipeList { width: 570px} #recipeImage {width: 570} #recImg {width: 570}}

            @media (max-width: 1280px) { .form {width: 1080px} .collapse {width: 1080px} }
            @media (max-width: 1280px) { #recipes {width: 1080px} #recipeListItem {width: 1080px} }
            @media (max-width: 1280px) { #recipeList { width: 520px} #recipeImage {width: 520} #recImg {width: 520}}

            @media (max-width: 1180px) { .form {width: 980px} .collapse {width: 980px} }
            @media (max-width: 1180px) { #recipes {width: 980px} #recipeListItem {width: 980px} }
            @media (max-width: 1180px) { #recipeList { width: 470px} #recipeImage {width: 470} #recImg {width: 470} }
            @media (max-width: 1180px) { h2 { font-size: 27} }

            @media (max-width: 1080px) { .form {width: 880px} .collapse {width: 880px}}
            @media (max-width: 1080px) { #recipes {width: 880px} #recipeListItem {width: 880px}}
            @media (max-width: 1080px) { #recipeList { width: 420px} #recipeImage {width: 420} #recImg {width: 420}}
            @media (max-width: 1080px) { .title {font-size: 18px} #listofingred, #allergies, #diet {font-size: 15px} .num {width: 50px; height: 50px; font-size: 25px; line-height: 50px}}
            @media (max-width: 1080px) { h2 { font-size: 23} }

            @media (max-width: 930px) { .form {width: 780px} .collapse {width: 780px} }
            @media (max-width: 930px) { #recipes {width: 780px} #recipeListItem {width: 780px} }
            @media (max-width: 930px) { #recipeList { width: 370px} #recipeImage {width: 370} #recImg {width: 370}}
            @media (max-width: 930px) { .title {font-size: 15px} #listofingred, #allergies, #diet {font-size: 12px} .num {width: 40px; height: 40px; font-size: 20px; line-height: 40px} }
            @media (max-width: 930px) { #mealtype {width: 80px; font-size: 12px} #nutrition {width: 80px; font-size: 12px} input[type="number"] {width: 80px; font-size: 12px}}
            @media (max-width: 930px) { .title {margin-right: 0px} }

            @media (max-width: 820px) { .form {width: 680px} .collapse {width: 680px} }
            @media (max-width: 820px) { #recipes {width: 680px} #recipeListItem {width: 680px} }
            @media (max-width: 820px) { #recipeList { width: 320px} #recipeTitle {font-size: 22px} #recipeList {font-size: 15px} #recipeImage {width: 320} #recImg {width: 320}}
            @media (max-width: 820px) { .title {font-size: 12px} #listofingred, #allergies, #diet {font-size: 10px} .num {width: 30px; height: 30px; font-size: 15px; line-height: 30px} }
            @media (max-width: 820px) { #mealtype {width: 60px; font-size: 10px} #nutrition {width: 60px; font-size: 10px} input[type="number"] {width: 60px; font-size: 10px}}
            @media (max-width: 820px) { h2 { font-size: 18px } }

            @media (max-width: 720px) { .form {width: 580px} .collapse {width: 580px} .title {margin-right: 10px}}
            @media (max-width: 720px) { #recipes {width: 580px} #recipeListItem {width: 580px}  }
            @media (max-width: 720px) { #recipeList { width: 270px} #recipeImage {width: 270} #recImg {width: 270}}
            @media (max-width: 720px) { h2 { font-size: 15} }

            @media (max-width: 620px) { .form {width: 460px} .collapse {width: 460px} }
            @media (max-width: 620px) { #recipes {width: 460px} #recipeListItem {width: 460px} }
            @media (max-width: 620px) { #recipeList { width: 210px} #recipeTitle {font-size: 18px} #recipeList {font-size: 12px} #recipeImage {width: 210} #recImg {width: 210}}
            @media (max-width: 620px) { .title {font-size: 10px} #listofingred, #allergies, #diet {font-size: 8px} .num {width: 20px; height: 20px; font-size: 12px; line-height: 20px} }
            @media (max-width: 620px) { #mealtype {width: 40px; font-size: 8px} #nutrition {width: 40px; font-size: 8px} input[type="number"] {width: 40px; font-size: 8px}}
            @media (max-width: 620px) { h2 { font-size: 12} }
            @media (max-width: 620px) { #submit {width: 175px; font-size: 15} #edit {width: 175px; font-size: 15} .editbtn {width: 175px; } .submitbtn {width: 175px} }


            @media (max-width: 490px) { .form {width: 350px} .collapse {width: 350px} }
            @media (max-width: 490px) { #recipes {width: 350px} #recipeListItem {width: 350px} }
            @media (max-width: 490px) { #recipeList { width: 155px} #recipeTitle {font-size: 14px} #recipeList {font-size: 10px} #recipeImage {width: 155} #recImg {width: 155}}
            @media (max-width: 490px) { .title {font-size: 6px} #listofingred, #allergies, #diet {font-size: 4px} .num {width: 10px; height: 10px; font-size: 8px; line-height: 10px} }
            @media (max-width: 490px) { #mealtype {width: 30px; font-size: 6px} #nutrition {width: 30px; font-size: 6px} input[type="number"] {width: 30px; font-size: 6px}}
            @media (max-width: 490px) { .editbtn {width: 100px; } .submitbtn { width: 100px; } #submit { width: 100px; font-size: 10px } #edit { width: 100px; font-size: 10px }}
            @media (max-width: 490px) { h2 { font-size: 10} }

        </style>

        <script src="https://code.jquery.com/jquery-3.6.3.js"
        integrity="sha256-nQLuAZGRRcILA+6dMBOvcRh5Pe310sBpanc6+QBmyVM="
        crossorigin="anonymous"></script>

        <script>

            window.onload=function() {
                document.getElementById("edit").onclick = function () {
                    document.getElementsByName("form")[0].style.display = "block";
                    document.getElementsByName("collapse")[0].style.display = "none";
                }
            }

        </script>

    </head>

    <script>

        function populateForm()
        {
            //*****************ERIC POPULATE ARRAY HERE************************
            //array of food items from database somehow
            const foodItems = ['Chicken', 'Steak', 'Olive Oil', "Banana"];
        
            //*****************ERIC POPULATE BOOL HERE************************
            //bool value subscribed or not, get from database
            var subscribed = false;
        
            var ingredientCell = document.createElement('td');
            ingredientCell.setAttribute("id", "listofingred");
        
            for (let i = 0; i < foodItems.length; i++) 
            {
                //create button for each ingredient
                const checkbox = document.createElement('input');
                
                //check if subscribed
                if(subscribed)
                {
                    checkbox.type = 'checkbox';
                }
                else
                {
                    checkbox.type = 'radio';
                }
                checkbox.name = "ingredient";
                checkbox.className = 'ingredient';
                checkbox.value = foodItems[i].toLowerCase();
                checkbox.id = `ingredient${i+1}`;
                ingredientCell.appendChild(checkbox);
        
                //create label
                const label = document.createElement('label');
                label.htmlFor = `ingredient${i+1}`;
                label.appendChild(document.createTextNode(foodItems[i]));
                ingredientCell.appendChild(label);
        
                ingredientCell.appendChild(document.createElement('br'));
            
                var ingredientDisplay = document.getElementById("userIngredientSection");
                ingredientDisplay.appendChild(ingredientCell);
            }
        }    
        </script>
<body>
    <div class="header">
        <ul class="nav">
            <li id="header"><img src="navlogo.png" height="70px" class="logo"></li>
            <li id="header" class="right"><a  class="headerlink" href="https://mymeals.herokuapp.com/profile">&nbsp; &nbsp;<img src="profile.png" height="50px" class="userPage"><text class="headertext">PROFILE</text></a></li>
        </ul>
    </div>

    <div id="prof-header-bg">
        <section class="prof-header">
            
        <div id="prof-header-text-box">
            <div id="prof-header-text">
                <h1>Find Your Custom Recipes</h1>
                <p>Pick your main ingredient and fill out the form to get recommened the perfect recipe based on your ingredients.</p>
            </div>
        </div>
                
        </section>
    </div>

<div class="content">
    <form class="form" name="form" method='get' onsubmit="event.preventDefault()">
        <table>
            <tr id="userIngredientSection">
              <td class="tdTitle">
                <div class="title">
                    <h2><label class="num">1</label>Choose Your Main Ingredient</h2>
                </div>
              </td>
              <script>
                populateForm();
              </script>
            </tr>
            <tr>
                <td>
                    <div class="title">
                        <h2><label class="num">2</label>Choose Your Max Cooking Time (minutes) &nbsp &nbsp &nbsp</h2>
                    </div>
                </td>
                <td><input type='number' min="0" max="120" name='minutes' id='minutes'/></td>
            </tr>
            <tr>
                <td>
                    <div class="title">
                        <h2><label class="num">3</label>Choose Your Course Type</h2>
                    </div>
                </td>
                <td>
                    <select name='mealtype' id='mealtype'>
                    <option>All</option>
                    <option>breakfast</option>
                    <option>lunch</option>
                    <option>dinner</option>
                    <option>dessert</option>
                    </select>
                </td>
            </tr>
            <tr>
                <td>
                    <div class="title">
                        <h2><label class="num">4</label>Choose Your Nutrition Options</h2>
                    </div>
                </td>
                <td>
                    <select name='nutrition' id='nutrition'>
                    <option>none</option>
                    <option>balanced</option>
                    <option>high-fiber</option>
                    <option>high-protein</option>
                    <option>low-carb</option>
                    <option>low-fat</option>
                    <option>low-sodium</option>
                    </select>
                </td>
            </tr>
            <tr>
                <td class="tdTitle">
                    <div class="title">
                        <h2><label class="num">5</label>Excluding the Following Allergens:</h2>
                    </div>
                </td>
                <td>
                    <ul name='allergies' id='allergies'>
                    </ul>
                </td>
            </tr>
            <tr>
                <td class="tdTitle">
                    <div class="title">
                        <h2><label class="num">6</label>With the Following Diets:</h2>
                    </div>
                </td>
                <td>
                    <ul name='diet' id='diet'>
                    </ul>
                </td>
            </tr>
        </table>
        <br />
        <div class="submitbtn">
            <input type = 'button'  id="submit" value= 'Get Your Recipes' onclick="sendReq()"/>
        </div>
        <br />
    </form>
    <div class="collapse" name="collapse">
        <div class="editbtn">
            <input type="button" id="edit" value="Edit Your Search"/>
        </div>
    </div>
</div>
<div id="recipes">

</div>
<script>

//populateForm();


function sendReq()
{
//process additional search modifiers into strings and append request URL
var additionalQueries = "";

var mealtype = document.getElementById('mealtype').value;
if(mealtype != 'All')
{
    additionalQueries = additionalQueries + "&mealType=" + mealtype;
}

var nutrition = document.getElementById('nutrition').value;
if(nutrition != 'none')
{
    additionalQueries = additionalQueries + "&diet=" + nutrition;
}

var minutes = document.getElementById('minutes').value;
if(minutes.trim() != '')
{
    additionalQueries = additionalQueries + "&time=" + nutrition;
}

//*****************ERIC POPULATE ARRAY HERE************************
//assume this array is a list of allergens/excluded ingredients from database
var allergenObjectString = "";
var allergenObjectArray = document.querySelectorAll('#allergies li');
for(var p = 0; p < allergenObjectArray.length; p++)
{
    allergenObjectString = allergenObjectArray[q].value;
    additionalQueries = additionalQueries + "&excluded=" + allergens[p];
}

//*****************ERIC POPULATE ARRAY HERE************************
//assume this array is a list of diet/health options from database
var dietaryObjectString = "";
var dietaryObjectArray = document.querySelectorAll('#diet li');
for(var q = 0; q < dietaryObjectArray.length; q++)
{
    dietaryObjectString = dietaryObjectArray[q].value;
    additionalQueries = additionalQueries + "&health=" + dietaryObjectString;
}

//process ingredients into string
var query = "";
var atLeastOneSelected = false;

var ingredients = document.querySelectorAll('.ingredient');

//create + populate array of user's ingredients
//this currently gets the list from the form, which should be populated from
//the database 
var userIngredientList = [];

for (var i = 0; i < ingredients.length; i++) 
{
    //populate user ingredient list
    userIngredientList.push(ingredients[i].value);

    if(ingredients[i].checked) 
    {
        //validate + add selected ingredients to query
        atLeastOneSelected = true;
        query = query + " " + (ingredients[i].value);
    }
}

if(atLeastOneSelected === false)
{
    alert("Please Select at Least 1 Ingredient!");
    return false;
}
else
{
    document.getElementsByName("form")[0].style.display = "none";
    document.getElementsByName("collapse")[0].style.display = "block";
    var requestURL = `https://api.edamam.com/search?q=${query}&app_id=523efb53&app_key=a72279eac472b5a8e9a9ce6f904aaea4${additionalQueries}`;
    fetch(requestURL)
    .then(response => response.json())
    .then(data => 
    {
        //store entire response
        var jsonData = data;
        console.log(jsonData);

        //isolate recipes
        var hits = jsonData.hits;

        //get recipeSection as an object and clear it in case of a re-search
        var recipeSection = document.getElementById("recipes");
        recipeSection.textContent="";

        //create array for storing recipe divs
        var recipesAndMatchCount = [];

        for (var i = 1; i < hits.length + 1; i++) 
        {
            //create recipe variable
            var currentRecipe = hits[i-1];

            //get recipe title string
            var recipeLabel = hits[i-1].recipe.label;

            //create header object for storing recipe name
            var recipeLabelObject = document.createElement('h2');
            recipeLabelObject.setAttribute("id", "recipeTitle");
            recipeLabelObject.textContent = recipeLabel;


            //create div object for storing entire recipe and add header
            var recipeListItem = document.createElement('div');
            recipeListItem.setAttribute("id", "recipeListItem");
            recipeListItem.appendChild(recipeLabelObject);

            //create table for storing image on left and recipe on right
            var imageAndItemsTable = document.createElement('table');
            var imageAndItemsTableRow = document.createElement('tr');
            var imageColumn = document.createElement('th');
            imageColumn.setAttribute("id", "recipeImage");
            var recipeColumn = document.createElement('th');
            recipeColumn.setAttribute("id", "recipeList")
            imageAndItemsTableRow.appendChild(imageColumn);
            imageAndItemsTableRow.appendChild(recipeColumn);
            imageAndItemsTable.appendChild(imageAndItemsTableRow);


            //create list object for storing ingredients, then add to div
            var ingredientList = document.createElement('ul');

            //ingredientLines variable, array of strings
            var ingredientLines = currentRecipe.recipe.ingredientLines;

            //create p object for stating matching ingredient #
            var matchingIngredientStatement = document.createElement('p');

            //check each user ingredient to see if it matches ingredientlines
            var matchingIngredients = 0;
            for (var k = 0; k < userIngredientList.length; k++)
            {
                var userIngredient = userIngredientList[k].toLowerCase();
                for (var l = 0; l < ingredientLines.length; l++)
                {
                    var recipeIngredient = ingredientLines[l].toLowerCase();
                    if(recipeIngredient.indexOf(userIngredient) !== -1)
                    {
                        matchingIngredients++;
                        break;
                    }
                }
            }
            matchingIngredientStatement.textContent = "Matching Ingredients: " + matchingIngredients;
            recipeListItem.appendChild(matchingIngredientStatement);


            //populate ingredientList object
            for (var j = 0; j < ingredientLines.length; j++) 
            {
                var ingredient = document.createElement('li');
                ingredient.textContent = ingredientLines[j];
                ingredientList.appendChild(ingredient);
            }
            recipeColumn.appendChild(ingredientList);

            //create img
            var image = document.createElement('img');
            image.setAttribute("id", "recImg");
            image.src = currentRecipe.recipe.image;
            imageColumn.appendChild(image);

            //add image+list table to div
            recipeListItem.appendChild(imageAndItemsTable);

            //add link to end
            //create link object
            var link = `${currentRecipe.recipe.url}`;
            console.log(currentRecipe.recipe.url);
            //fix link if http
            if(link.includes("http://"))
            {
                link = link.split("http://");
                console.log(link[1]);
                link = "https://" + link[1];
            }
            var recipeLink = document.createElement('a');
            var linkDiv = document.createElement('div');
            linkDiv.setAttribute("id", "linkDiv");
            recipeLink.setAttribute("id", "recipeLink");
            recipeLink.href = link;
            recipeLink.textContent = `Go to Recipe`;
            recipeLink.target='blank';
            linkDiv.appendChild(recipeLink);
            recipeListItem.appendChild(linkDiv);

            

            //store crafted recipe div in array with ingredient match count
            recipesAndMatchCount.push(
            {
                recipe: recipeListItem,
                matchCount: matchingIngredients
            });
        }

        //sort array of recipe divs by ingredient match count
        recipesAndMatchCount.sort(function(a, b)
        {
            return b.matchCount - a.matchCount;
        });

        //add all recipes to page
        for (var m = 0; m < recipesAndMatchCount.length; m++)
        {
            recipeSection.appendChild(recipesAndMatchCount[m].recipe);
        }

        
    })  
    .catch(error => console.error(error));
}
}
</script>

</body>
</html>
