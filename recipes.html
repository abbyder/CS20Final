<html>
    <head>
        <title>Recipes | MyMeals</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <style type="text/css">
            .form {
                background-color: #ffa4d0;
                padding-top: 20px;
                margin-left: 200px;
                margin-right: 200px;
                margin-top: 20px;
                padding-left: 20px;
                padding-bottom: 20px
            }
            .collapse {
                background-color: #ffa4d0;
                padding-top: 20px;
                margin-left: 200px;
                margin-right: 200px;
                margin-top: 50px;
                padding-left: 20px;
                padding-bottom: 20px;
                display: none
            }
            .num {
                display: inline-block;
                background-color: #f9d00f;
                border-radius: 50%;
                margin-right: 20px;
                font-size: 30px;
                width: 60px;
                height: 60px;
                line-height: 60px;
                text-align: center;
            }
            h2 {
                color: #fff;
            }
            .title {
                height: 60px;
                line-height: 60px;
                font-size: 20px;
            }
            #submit {
                border-radius: 8px;
                background-color:#f9d00f;
                color:#fff;
                border: none;
                width: 175px;
                height: 40px;
                font-size: 20px;
            }
            #edit {
                border-radius: 8px;
                background-color:#f9d00f;
                color:#fff;
                border: none;
                width: 175px;
                height: 40px;
                font-size: 20px;
            }
            .editbtn {
                width: 175px;
                margin: 0 auto
            }
            .submitbtn {
                width: 175px;
                margin: 0 auto
            }
            .leftrecipes {
                display: block;
                margin: 0 auto;
                width: 350px;
            }
            .recipes {
                display: block;
                margin: 0 auto;
                width: 700px;
            }
            .leftrecipes {
                display: block;
                margin: 0 auto;
                width: 350px;
                float: left;
                text-align: center;
            }
            .rightrecipes {
                display: block;
                margin: 0 auto;
                width: 350px;
                float: left;
                text-align: center;
            }
            td {
                padding-top: 30px;
            }
            .ingredients {
                font-size: 20px;
            }
            h1 {
                text-align: center;
                color:#f9d00f;
                font-size: 40px;
                margin-top: 50px
            }
            #mealtype {
                color:#ffa4d0;
                height: 30px;
                width: 100px;
                font-size: 15px;
                text-align: center
            }
            #diet {
                color:#ffa4d0;
                height: 30px;
                width: 100px;
                font-size: 15px;
                text-align: center
            }
            input[type="number"] {
                color:#ffa4d0;
                height: 30px;
                width: 100px;
                font-size: 15px;
                text-align: center
            }
            .recipeImage {
                margin: 0 auto;
                float: left;
            }
            .recipeIngredients {
                margin: 0 auto;
                float: left
            }
            #recipe1 {
                width: 50%
            }
            .titleLink {
                text-align: center;
                color:#f9d00f
            }
            h3 {
                text-align: center;
            }
            .ingredientList {
                width: 50%
            }

        </style>

        <script src="https://code.jquery.com/jquery-3.6.3.js"
        integrity="sha256-nQLuAZGRRcILA+6dMBOvcRh5Pe310sBpanc6+QBmyVM="
        crossorigin="anonymous"></script>

        <script>

            window.onload=function() {
                document.getElementById("edit").onclick = function () {
                    document.getElementsByName("form")[0].style.display = "block";
                    document.getElementsByName("collapse")[0].style.display = "none";
                }
            }

        </script>

    </head>

    <body>
        <div class="content">
            <h1>Find Your Custom Recipes</h1>
            <form class="form" name="form" method='get' onsubmit="event.preventDefault()">
                <table>
                    <tr>
                      <td>
                        <div class="title">
                            <h2><label class="num">1</label>Choose Your Main Ingredient</h2>
                        </div>
                      </td>
                      <td class="ingredients">
                        <input type="checkbox" class="ingredient" value="chicken">
                        <label for="ingredient1">Chicken</label><br>
                        <input type="checkbox" class="ingredient" value="steak">
                        <label for="ingredient2">Steak</label><br>
        
                      </td>
                    </tr>
                    <tr>
                        <td>
                            <div class="title">
                                <h2><label class="num">2</label>Choose Your Max Cooking Time (minutes) &nbsp &nbsp &nbsp</h2>
                            </div>
                        </td>
                        <td><input type='number' min="0" max="120" name='minutes'/></td>
                    </tr>
                    <tr>
                        <td>
                            <div class="title">
                                <h2><label class="num">3</label>Choose Your Course Type</h2>
                            </div>
                        </td>
                        <td>
                            <select name='mealtype' id='mealtype'>
                            <option>All</option>
                            <option>Breakfast</option>
                            <option>Lunch</option>
                            <option>Dinner</option>
                            <option>Dessert</option>
                            </select>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <div class="title">
                                <h2><label class="num">4</label>Choose Your Dietary Options</h2>
                            </div>
                        </td>
                        <td>
                            <select name='diet' id='diet'>
                            <option>none</option>
                            <option>balanced</option>
                            <option>high-fiber</option>
                            <option>high-protein</option>
                            <option>low-carb</option>
                            <option>low-fat</option>
                            <option>low-sodium</option>
                            </select>
                        </td>
                    </tr>
                </table>
                <br />
                <div class="submitbtn">
                    <input type = 'button'  id="submit" value= 'Get Your Recipes' onclick="sendReq()"/>
                </div>
                <br />
            </form>
            <div class="collapse" name="collapse">
                <div class="editbtn">
                    <input type="button" id="edit" value="Edit Your Search"/>
                </div>
            </div>
        </div>
        <div id="recipes">
            <div id="recipe1">
                <div class="recipeImage">
                    <h3><a class="titleLink" href="http://www.seriouseats.com/recipes/2011/12/chicken-vesuvio-recipe.html">Chicken Vesuvio</a></h3>
                    <img src="mymeals logos\facebook_profile_image.png" id="logo" height="200"/>
                </div>
                <div class="recipeIngredients">
                    <br /> <br />
                    <ul class="ingredientList">
                        <li>1/2 cup olive oil</li>
                        <li>5 cloves garlic, peeled</li>
                        <li>2 large russet potatoes, peeled and cut into chunks</li>
                        <li>1 3-4 pound chicken, cut into 8 pieces (or 3 pound chicken legs)</li>
                        <li>3/4 cup white wine</li>
                        <li>3/4 cup chicken stock</li>
                        <li>3 tablespoons chopped parsley</li>
                        <li>1 tablespoon dried oregano</li>
                        <li>Salt and pepper</li>
                        <li>1 cup frozen peas, thawed</li>
                    </ul>
                </div>
            </div>
        </div>


        <script>

function sendReq()
{
    //process additional search modifiers into strings and append request URL
    var additionalQueries = "";

    var mealtype = document.getElementById('mealtype').value;
    if(mealtype != 'All')
    {
        additionalQueries = additionalQueries + "&mealType=" + mealtype;
    }

	var diet = document.getElementById('diet').value;
    if(diet != 'none')
    {
        additionalQueries = additionalQueries + "&diet=" + diet;
    }

    //process ingredients into string
    var query = "";
    var atLeastOneSelected = false;

    var ingredients = document.querySelectorAll('.ingredient');

    //create + populate array of user's ingredients
    //this currently gets the list from the form. Should be updated to grab
    //list from the database in future.
    var userIngredientList = [];

    for (var i = 0; i < ingredients.length; i++) 
    {
        //populate user ingredient list
        userIngredientList.push(ingredients[i].value);

        if(ingredients[i].checked) 
        {
            atLeastOneSelected = true;
            query = query + " " + (ingredients[i].value);
        }
    }

    if(atLeastOneSelected === false)
    {
        alert("Please Select at Least 1 Ingredient!");
        return false;
    }
    else
    {
        document.getElementsByName("form")[0].style.display = "none";
        document.getElementsByName("collapse")[0].style.display = "block";
        var requestURL = `https://api.edamam.com/search?q=${query}&app_id=523efb53&app_key=a72279eac472b5a8e9a9ce6f904aaea4${additionalQueries}`;
        fetch(requestURL)
        .then(response => response.json())
        .then(data => 
        {
            //store entire response
            var jsonData = data;
            console.log(jsonData);

            //isolate recipes
            var hits = jsonData.hits;

            //get recipeSection as an object and clear it in case of a re-search
            var recipeSection = document.getElementById("recipes");
            recipeSection.textContent="";

            for (var i = 1; i < hits.length + 1; i++) 
            {
                //create recipe variable
                var currentRecipe = hits[i-1];

                //get recipe title string
                var recipeLabel = hits[i-1].recipe.label;

                //create header object for storing recipe name
                var recipeLabelObject = document.createElement('h3');
               // recipeLabelObject.textContent = `Recipe ${i}: ${recipeLabel}`;
                var link = `Recipe ${i} : ${currentRecipe.recipe.url}`;
                link = link.split("http://");
                console.log(link[1]);
                link = "https://" + link[1];
                //console.log(link);
                
                var recipeLink = document.createElement('a');
                recipeLink.href = link;
                recipeLink.textContent = `Recipe ${i}: ${recipeLabel}`;
                recipeLabelObject.appendChild(recipeLink);


                //create div object for storing entire recipe and add header
                var recipeListItem = document.createElement('div');
                recipeListItem.appendChild(recipeLabelObject);
                recipeListItem.appendChild(recipeLink);

                //create list object for storing ingredients, then add to div
                var ingredientList = document.createElement('ul');

                //ingredientLines variable, array of strings
                var ingredientLines = currentRecipe.recipe.ingredientLines;

                //create p object for stating matching ingredient #
                var matchingIngredientStatement = document.createElement('p');

                //check each user ingredient to see if it matches ingredientlines
                var matchingIngredients = 0;
                for (var k = 0; k < userIngredientList.length; k++)
                {
                    var userIngredient = userIngredientList[k].toLowerCase();
                    for (var l = 0; l < ingredientLines.length; l++)
                    {
                        var recipeIngredient = ingredientLines[l].toLowerCase();
                        if(recipeIngredient.indexOf(userIngredient) !== -1)
                        {
                            matchingIngredients++;
                        }
                    }
                }
                matchingIngredientStatement.textContent = "Matching Ingredients: " + matchingIngredients;
                recipeListItem.appendChild(matchingIngredientStatement);


                console.log(ingredientLines);
                for (var j = 0; j < ingredientLines.length; j++) 
                {
                    var ingredient = document.createElement('li');
                    ingredient.textContent = ingredientLines[j];
                    ingredientList.appendChild(ingredient);
                }
                recipeListItem.appendChild(ingredientList);

                //add entire recipe item to div
                recipeSection.appendChild(recipeListItem);
                console.log(`Recipe ${i}: ${recipeLabel}`);
            }
        })  
        .catch(error => console.error(error));
    }
}
</script>

    </body>
</html>